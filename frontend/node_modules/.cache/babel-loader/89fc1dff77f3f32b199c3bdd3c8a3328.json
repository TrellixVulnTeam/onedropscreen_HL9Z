{"ast":null,"code":"import _regeneratorRuntime from\"/home/vrdevchris/rappaSite/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/vrdevchris/rappaSite/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/vrdevchris/rappaSite/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{Link}from'react-router-dom';import{detailsOrder,payOrder}from'../actions/orderActions';import{PayPalButton}from'react-paypal-button-v2';import Axios from'axios';import LoadingBox from'../components/LoadingBox';import MessageBox from'../components/MessageBox';import{ORDER_PAY_RESET}from'../constants/orderConstants';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function OrderScreen(props){var orderId=props.match.params.id;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var orderDetails=useSelector(function(state){return state.orderDetails;});var order=orderDetails.order,loading=orderDetails.loading,error=orderDetails.error;var orderPay=useSelector(function(state){return state.orderPay;});var loadingPay=orderPay.loading,successPay=orderPay.success,errorPay=orderPay.error;var dispatch=useDispatch();useEffect(function(){console.log(\"this is the useEffect from Orderscreen\");var addPayPalScript=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Axios$get,data,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Axios.get('/api/config/paypal');case 2:_yield$Axios$get=_context.sent;data=_yield$Axios$get.data;script=document.createElement('script');script.type='text/javascript';script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(data);script.async=true;script.onload=function(){setSdkReady(true);};document.body.appendChild(script);case 10:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref.apply(this,arguments);};}();if(!order||successPay||order&&order._id!==orderId){dispatch({type:ORDER_PAY_RESET});dispatch(detailsOrder(orderId));}else{if(!order.isPaid){if(!window.paypal){addPayPalScript();}else{setSdkReady(true);}}}},[dispatch,orderId,sdkReady,successPay,order,successPay]);var handleSuccessPayment=function handleSuccessPayment(paymentResult){dispatch(payOrder(order,paymentResult));};return loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"placeorder\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"placeorder-info\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"div\",{children:[order.shipping.address,\", \",order.shipping.city,\", \",order.shipping.state,order.shipping.zipCode,\", \",order.shipping.country]}),/*#__PURE__*/_jsx(\"div\",{children:order.isDelivered?/*#__PURE__*/_jsxs(MessageBox,{variant:\"success\",children:[\"Delivered at \",order.deliveredAt]}):/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:\"Not Delivered\"})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Payment\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Payment Method: \",order.payment.paymentMethod]}),/*#__PURE__*/_jsx(\"div\",{children:order.isPaid?\"Paid at \"+order.paidAt:\"Not Paid.\"})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"ul\",{className:\"cart-list-container\",children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Shopping Cart\"}),/*#__PURE__*/_jsx(\"div\",{children:\"Price\"})]}),order.orderItems.length===0?/*#__PURE__*/_jsx(\"div\",{children:\"Cart is empty\"}):order.orderItems.map(function(item){return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"cart-image\",children:/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:\"product\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-name\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Link,{to:\"/product/\"+item.product,children:item.name})}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Qty: \",item.qty]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"cart-price\",children:[\"$\",item.price]})]},item._id);})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"placeorder-action\",children:/*#__PURE__*/_jsxs(\"ul\",{children:[!order.isPaid&&/*#__PURE__*/_jsx(\"li\",{className:\"placeorder-actions-payment\",children:!sdkReady?/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[errorPay&&/*#__PURE__*/_jsx(\"div\",{children:errorPay}),loadingPay&&/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"}),/*#__PURE__*/_jsx(PayPalButton,{amount:order.totalPrice,onSuccess:handleSuccessPayment})]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"h3\",{children:\"Order Summary\"})}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"div\",{children:\"Items\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"$\",order.itemsPrice]})]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"div\",{children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"$\",order.shippingPrice]})]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"div\",{children:\"Tax\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"$\",order.taxPrice]})]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"div\",{children:\"Order Total\"}),/*#__PURE__*/_jsxs(\"div\",{children:[\"$\",order.totalPrice]})]})]})})]})});}export default OrderScreen;","map":{"version":3,"sources":["/home/vrdevchris/rappaSite/frontend/src/Screens/OrderScreen.js"],"names":["React","useEffect","useState","useDispatch","useSelector","Link","detailsOrder","payOrder","PayPalButton","Axios","LoadingBox","MessageBox","ORDER_PAY_RESET","OrderScreen","props","orderId","match","params","id","sdkReady","setSdkReady","orderDetails","state","order","loading","error","orderPay","loadingPay","successPay","success","errorPay","dispatch","console","log","addPayPalScript","get","data","script","document","createElement","type","src","async","onload","body","appendChild","_id","isPaid","window","paypal","handleSuccessPayment","paymentResult","shipping","address","city","zipCode","country","isDelivered","deliveredAt","payment","paymentMethod","paidAt","orderItems","length","map","item","image","product","name","qty","price","totalPrice","itemsPrice","shippingPrice","taxPrice"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Link } from 'react-router-dom';\nimport { detailsOrder, payOrder } from '../actions/orderActions';\nimport { PayPalButton } from 'react-paypal-button-v2';\nimport Axios from 'axios';\nimport LoadingBox from '../components/LoadingBox';\nimport MessageBox from '../components/MessageBox';\nimport { ORDER_PAY_RESET } from '../constants/orderConstants';\n\n\nfunction OrderScreen(props) {\n\n  const orderId = props.match.params.id;\n  const [sdkReady, setSdkReady] = useState(false);\n\n  const orderDetails = useSelector((state) => state.orderDetails);\n  const { order, loading, error } = orderDetails;\n\n  const orderPay = useSelector((state) => state.orderPay);\n  const { loading: loadingPay, success: successPay, error: errorPay } = orderPay;\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    console.log(\"this is the useEffect from Orderscreen\")\n    const addPayPalScript = async () => {\n      const { data } = await Axios.get('/api/config/paypal');\n      const script = document.createElement('script');\n      script.type = 'text/javascript';\n      script.src = `https://www.paypal.com/sdk/js?client-id=${data}`;\n      script.async = true;\n      script.onload = () => {\n        setSdkReady(true);\n      };\n      document.body.appendChild(script);\n    };\n    if (\n      !order ||\n      successPay ||\n      (order && order._id !== orderId)\n    ) {\n      dispatch({ type: ORDER_PAY_RESET });\n      dispatch(detailsOrder(orderId));\n    } else {\n      if (!order.isPaid) {\n        if (!window.paypal) {\n          addPayPalScript();\n        } else {\n          setSdkReady(true);\n        }\n      }\n    }\n  }, [dispatch, orderId, sdkReady, successPay, order, successPay]);\n\n  const handleSuccessPayment = (paymentResult) => {\n    dispatch(payOrder(order, paymentResult));\n  }\n\n\n  return loading ? (\n    <LoadingBox></LoadingBox> \n    ) : error ? (\n      <MessageBox variant=\"danger\">{error}</MessageBox>\n    ) : (\n\n    <div>\n      <div className=\"placeorder\">\n        <div className=\"placeorder-info\">\n          <div>\n            <h3>\n              Shipping\n          </h3>\n            <div>\n              {order.shipping.address}, {order.shipping.city}, {order.shipping.state}\n              {order.shipping.zipCode}, {order.shipping.country}\n            </div>\n            <div>\n              {order.isDelivered ? (\n                <MessageBox variant=\"success\">Delivered at {order.deliveredAt}</MessageBox>\n              ) : (\n                <MessageBox variant=\"danger\">Not Delivered</MessageBox>\n              )}\n            </div>\n          </div>\n          <div>\n            <h3>Payment</h3>\n            <div>\n              Payment Method: {order.payment.paymentMethod}\n            </div>\n            <div>\n              {order.isPaid ? \"Paid at \" + order.paidAt : \"Not Paid.\"}\n            </div>\n          </div>\n          <div>\n            <ul className=\"cart-list-container\">\n              <li>\n                <h3>\n                  Shopping Cart\n          </h3>\n                <div>\n                  Price\n          </div>\n              </li>\n              {\n                order.orderItems.length === 0 ?\n                  <div>\n                    Cart is empty\n          </div>\n                  :\n                  order.orderItems.map(item =>\n                    <li key={item._id}>\n                      <div className=\"cart-image\">\n                        <img src={item.image} alt=\"product\" />\n                      </div>\n                      <div className=\"cart-name\">\n                        <div>\n                          <Link to={\"/product/\" + item.product}>\n                            {item.name}\n                          </Link>\n\n                        </div>\n                        <div>\n                          Qty: {item.qty}\n                        </div>\n                      </div>\n                      <div className=\"cart-price\">\n                        ${item.price}\n                      </div>\n                    </li>\n                  )\n              }\n            </ul>\n          </div>\n\n\n        </div>\n        <div className=\"placeorder-action\">\n          <ul>\n            {!order.isPaid && (\n            <li className=\"placeorder-actions-payment\">\n              {!sdkReady ? (\n                <div>Loading...</div>\n              ) : (\n                <>\n                {errorPay && (\n                  <div>{errorPay}</div>\n                )}\n                {loadingPay && (\n                  <div>Loading...</div>\n                )}\n                <PayPalButton amount={order.totalPrice} onSuccess={handleSuccessPayment}></PayPalButton>\n                \n                </>\n              )}\n            </li>\n            )}\n            <li>\n              <h3>Order Summary</h3>\n            </li>\n            <li>\n              <div>Items</div>\n              <div>${order.itemsPrice}</div>\n            </li>\n            <li>\n              <div>Shipping</div>\n              <div>${order.shippingPrice}</div>\n            </li>\n            <li>\n              <div>Tax</div>\n              <div>${order.taxPrice}</div>\n            </li>\n            <li>\n              <div>Order Total</div>\n              <div>${order.totalPrice}</div>\n            </li>\n          </ul>\n\n\n\n        </div>\n\n      </div>\n    </div>\n\n)}\n\nexport default OrderScreen;\n"]},"metadata":{},"sourceType":"module"}